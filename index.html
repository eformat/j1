<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Welcome to OpenShift</title>
  <link rel="stylesheet" type="text/css" href="lib/style.css"/>
  <script src="https://j1keycloak-thesteve0.rhcloud.com/auth/js/keycloak.js"></script>
</head>

<script>
var keycloak = new Keycloak();

window.onload = function () {
    keycloak.init({ onLoad: 'check-sso', checkLoginIframeInterval: 1 }).success(function () {
        if (keycloak.authenticated) {
            authenticated();
        } else {
        	keycloak.login()
            notAuthenticated();
        }
    } )
}

function authenticated() {
    document.getElementById('message').innerHTML = 'User: ' + keycloak.tokenParsed['preferred_username'];
}

function notAuthenticated() {
    document.getElementById('message').innerHTML = 'You shall not pass';
}

function request() {
    keycloak.updateToken(30).success(function() {
        var req = new XMLHttpRequest();
        var output = document.getElementById('message');
        req.open('GET', 'https://j1dd-thesteve0.rhcloud.com/ws/char', true);

        if (keycloak.authenticated) {
            console.debug('Adding token');
            req.setRequestHeader('Authorization', 'Bearer ' + keycloak.token);
        } else {
            console.debug('Not authenticated!!');
        }

        req.onreadystatechange = function () {
            if (req.readyState == 4) {
                if (req.status == 200) {
                    output.innerHTML = 'Message: ' + JSON.parse(req.responseText).message;
                } else {
                    output.innerHTML = '<span class="error">' + req.status + ' ' + req.statusText + '</span>';
                }
            }
        }

        req.send();
    });
}

</script>

<body>

<section class='container'>
          <hgroup>
            <h1>Welcome to your D&D character</h1>
          </hgroup>


        <div class="row">
          <section class='col-xs-12 col-sm-6 col-md-6'>
            <section>
              <h2>Message</h2>
              <div class="message" id="message"></div>
                
            </section>

          </section>
          <section class="col-xs-12 col-sm-6 col-md-6">

                <button onclick="request()">Generate character</button>

                <h2>Managing your application</h2>

                <h3>Web Console</h3>


          </section>
       

        <footer>
          <div class="logo"><a href="https://www.openshift.com/"></a></div>
        </footer>
</section>

</body>
</html>
